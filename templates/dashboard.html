<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Exoplanet Habitability Dashboard</title>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<style>
body {
    margin:0;
    font-family:"Segoe UI", sans-serif;
    background:#000;
    color:#fff;
    overflow-x:hidden;
}

/* ===== STAR BACKGROUND ===== */
canvas {
    position:fixed;
    inset:0;
    z-index:-1;
}

/* ===== NAV ===== */
nav {
    position:fixed;
    top:20px;
    right:30px;
    z-index:10;
    background:rgba(0,0,0,0.6);
    padding:12px 22px;
    border-radius:30px;
    backdrop-filter: blur(6px);
}
nav a {
    color:white;
    margin-left:20px;
    text-decoration:none;
    opacity:.85;
    font-weight:500;
}
nav a:hover { opacity:1; }

/* ===== LAYOUT ===== */
.container {
    max-width:1200px;
    margin:auto;
    padding:120px 30px 40px;
}

h1 { text-align:center; }
h2 { margin-top:45px; }

.grid {
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(350px,1fr));
    gap:25px;
    margin-top:25px;
}

.card {
    background:rgba(255,255,255,0.08);
    padding:20px;
    border-radius:12px;
}

table {
    width:100%;
    border-collapse:collapse;
    margin-top:15px;
}
th,td {
    border:1px solid rgba(255,255,255,.3);
    padding:8px;
    text-align:center;
}

button {
    background:#00c6ff;
    border:none;
    padding:10px 16px;
    border-radius:8px;
    cursor:pointer;
    font-weight:bold;
}
button:hover { background:#00a3d6; }

.export {
    text-align:right;
    margin-bottom:10px;
}

input[type=file] {
    margin-top:10px;
    color:white;
}
</style>
</head>

<body>

<canvas id="stars"></canvas>

<nav>
    <a href="/">Home</a>
    <a href="/predict">Predict</a>

</nav>

<div class="container">

<h1>üåå Exoplanet Habitability Dashboard</h1>
<p style="text-align:center">Interactive insights from machine learning predictions</p>

<!-- ===================== VISUAL INSIGHTS ===================== -->
<div class="grid">

    <div class="card">
        <h3>Feature Importance</h3>
        <div id="featurePlot"></div>
    </div>

    <div class="card">
        <h3>Habitability Score Distribution</h3>
        <div id="distPlot"></div>
    </div>

    <div class="card">
        <h3>Star‚ÄìPlanet Correlation</h3>
        <div id="corrPlot"></div>
    </div>

</div>

<!-- ===================== DB TOP 10 ===================== -->
<h2>üèÜ Top 10 Ranked Exoplanets (Database)</h2>

<div class="export">
    <button onclick="exportDBExcel()">‚¨á DB Excel</button>
    <button onclick="exportDBPDF()">‚¨á DB PDF</button>
</div>

<div id="ranking"></div>

<!-- ===================== CSV UPLOAD ===================== -->
<h2>üì§ Upload CSV & Rank Planets</h2>

<div class="card">
    <p>Upload a CSV file containing exoplanet features to predict and rank the top 10 habitable planets.</p>

    <input type="file" id="csvFile" accept=".csv">
    <br><br>
    <button onclick="uploadCSV()">Upload & Rank</button>

    <!-- CSV EXPORT (HIDDEN INITIALLY) -->
    <div class="export" id="csvExport" style="display:none">
        <button onclick="exportCSVExcel()">‚¨á CSV Excel</button>
        <button onclick="exportCSVPDF()">‚¨á CSV PDF</button>
    </div>

    <div id="csvRanking"></div>
</div>

</div>

<script>
const api = "http://127.0.0.1:5000";

/* ================= FEATURE IMPORTANCE ================= */
fetch(api+"/feature_importance")
.then(r=>r.json())
.then(d=>{
    Plotly.newPlot("featurePlot",[{
        x:d.importance,
        y:d.features,
        type:"bar",
        orientation:"h"
    }],{
        paper_bgcolor:"rgba(0,0,0,0)",
        plot_bgcolor:"rgba(0,0,0,0)",
        font:{color:"white"}
    });
});

/* ================= SCORE DISTRIBUTION ================= */
fetch(api+"/score_distribution")
.then(r=>r.json())
.then(scores=>{
    Plotly.newPlot("distPlot",[{
        x:scores,
        type:"histogram"
    }],{
        paper_bgcolor:"rgba(0,0,0,0)",
        plot_bgcolor:"rgba(0,0,0,0)",
        font:{color:"white"}
    });
});

/* ================= CORRELATION ================= */
fetch(api+"/correlations")
.then(r=>r.json())
.then(d=>{
    Plotly.newPlot("corrPlot",[{
        x:d.st_teff,
        y:d.score,
        mode:"markers"
    }],{
        xaxis:{title:"Star Temperature (K)"},
        yaxis:{title:"Habitability Score"},
        paper_bgcolor:"rgba(0,0,0,0)",
        plot_bgcolor:"rgba(0,0,0,0)",
        font:{color:"white"}
    });
});

/* ================= DB RANKING ================= */
fetch(api+"/rank")
.then(r=>r.json())
.then(data=>{
    let html=`<table>
    <tr><th>Rank</th><th>Planet</th><th>Score</th></tr>`;
    data.forEach(p=>{
        html+=`<tr>
        <td>${p.rank}</td>
        <td>${p.planet_name}</td>
        <td>${p.habitability_score.toFixed(4)}</td>
        </tr>`;
    });
    html+=`</table>`;
    document.getElementById("ranking").innerHTML=html;
});

/* ================= CSV UPLOAD ================= */
async function uploadCSV(){
    const fileInput = document.getElementById("csvFile");
    if(!fileInput.files.length){
        alert("Please select a CSV file");
        return;
    }

    const formData = new FormData();
    formData.append("file", fileInput.files[0]);

    const res = await fetch(api+"/upload_csv_rank",{method:"POST",body:formData});
    const data = await res.json();

    if(data.error){
        alert(data.error);
        return;
    }

    let html=`<table>
    <tr><th>Rank</th><th>Planet</th><th>Score</th></tr>`;
    data.forEach(p=>{
        html+=`<tr>
        <td>${p.rank}</td>
        <td>${p.planet_name}</td>
        <td>${p.habitability_score.toFixed(4)}</td>
        </tr>`;
    });
    html+=`</table>`;

    document.getElementById("csvRanking").innerHTML = html;
    document.getElementById("csvExport").style.display = "block";
}

/* ================= EXPORT ================= */
function exportDBExcel(){ window.location=api+"/export/excel"; }
function exportDBPDF(){ window.location=api+"/export/pdf"; }

function exportCSVExcel(){ window.location=api+"/export/csv_excel"; }
function exportCSVPDF(){ window.location=api+"/export/csv_pdf"; }

/* ================= STAR BACKGROUND ================= */
const c=document.getElementById("stars"),ctx=c.getContext("2d");
function resize(){c.width=innerWidth;c.height=innerHeight;}
resize();onresize=resize;

let stars=Array.from({length:260},()=>({
    x:Math.random()*c.width,
    y:Math.random()*c.height,
    r:Math.random()*1.6,
    s:Math.random()+.2
}));

(function anim(){
    ctx.clearRect(0,0,c.width,c.height);
    ctx.fillStyle="white";
    stars.forEach(s=>{
        ctx.beginPath();
        ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
        ctx.fill();
        s.y+=s.s; 
        if(s.y>c.height){
            s.y=0;
            s.x=Math.random()*c.width;
        }
    });
    requestAnimationFrame(anim);
})();
</script>

</body>
</html>
